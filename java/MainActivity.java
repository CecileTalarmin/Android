package com.example.snowtam_research;import androidx.appcompat.app.AppCompatActivity;import android.app.ProgressDialog;import android.content.Intent;import android.database.Cursor;import android.net.ConnectivityManager;import android.os.AsyncTask;import android.os.Bundle;import android.text.Editable;import android.text.TextWatcher;import android.util.Log;import android.view.KeyEvent;import android.view.MotionEvent;import android.view.View;import android.widget.Button;import android.widget.EditText;import android.widget.ImageButton;import android.widget.TextView;import android.widget.Toast;import org.json.JSONObject;import com.android.volley.Request;import com.android.volley.RequestQueue;import com.android.volley.Response;import com.android.volley.VolleyError;import com.android.volley.toolbox.JsonArrayRequest;import com.android.volley.toolbox.Volley;import org.json.JSONArray;import org.json.JSONException;import java.util.ArrayList;public class MainActivity extends AppCompatActivity {    private EditText mOACI_code1, mOACI_code2, mOACI_code3, mOACI_code4;    private ImageButton addImgBtn1, addImgBtn2, addImgBtn3, addImgBtn4;    private Button researchBtn;    private Intent intent;    private ArrayList<String> oaciList;    private ArrayList<String> jsonList;    String json_test = "SWEN0530 ENBO 11270246 \n(SNOWTAM 0530\nA) ENBO\nB) 11270246 C) 07\nF) 78/78/48 G) XX/XX/XX H) 3/3/3\nN) ALPHA BRAVO CHARLIE DELTA ECHO GOLF HOTEL INDIA\nJULIET MIKE WHISKEY YANKEE/78  FOXTROT QRA/5\nR) APRON EAST APRON WEST RWY EXTENSION WEST/78  ALL\nREMAINING APRONS/4\nT) CONTAMINATION/50/50/100/PERCENT.)\nCREATED: 27 Nov 2019 02:50:00 \nSOURCE: EUECYIYN";    Snowtam snowtam;    boolean textFocus = false; //define somewhere globally in the class    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        intent = new Intent(MainActivity.this, DisplayResultsActivity.class);        oaciList = new ArrayList<String>();        jsonList = new ArrayList<String>();        mOACI_code1 = (EditText) findViewById(R.id.oaciCode1);        mOACI_code2 = (EditText) findViewById(R.id.oaciCode2);        mOACI_code3 = (EditText) findViewById(R.id.oaciCode3);        mOACI_code4 = (EditText) findViewById(R.id.oaciCode4);        Log.i("CURSOR", String.valueOf(mOACI_code1.getSelectionEnd()));        if(mOACI_code1.getSelectionEnd() != mOACI_code1.getText().length()){            mOACI_code1.setSelection(mOACI_code1.getText().length());        }        mOACI_code1.setOnEditorActionListener(new TextView.OnEditorActionListener() {            @Override            public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {                mOACI_code1.setSelection(mOACI_code1.getText().length());                Log.i("CURSOR", String.valueOf(mOACI_code1.getSelectionEnd()));                return false;            }        });        addImgBtn1 = (ImageButton) findViewById(R.id.addImgBtn1);        addImgBtn2 = (ImageButton) findViewById(R.id.addImgBtn2);        addImgBtn3 = (ImageButton) findViewById(R.id.addImgBtn3);        addImgBtn4 = (ImageButton) findViewById(R.id.addImgBtn4);        researchBtn = (Button) findViewById(R.id.researchBtn);        addImgBtn1.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (mOACI_code1.getText().toString().length() == 4) {                    if(isOACIcode(mOACI_code1.getText().toString())){                        mOACI_code1.setEnabled(false);                        mOACI_code1.setKeyListener(null);                        mOACI_code2.setVisibility(View.VISIBLE);                        addImgBtn2.setVisibility(View.VISIBLE);                        researchBtn.setEnabled(true);                        oaciList.add(mOACI_code1.getText().toString());                        addImgBtn1.setImageResource(R.drawable.tick_inside_circle);                    }                    else{                        String warning_msg = getResources().getString(R.string.warning_msg_exist);                        Toast toast = Toast.makeText(getApplicationContext(), warning_msg, Toast.LENGTH_SHORT);                        toast.show();                    }                } else {                    String warnig_msg = getResources().getString(R.string.warning_msg_len);                    Toast toast = Toast.makeText(getApplicationContext(), warnig_msg, Toast.LENGTH_SHORT);                    toast.show();                }            }        });        addImgBtn2.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (mOACI_code2.getText().toString().length() == 4) {                    if(isOACIcode(mOACI_code2.getText().toString())){                        mOACI_code2.setEnabled(false);                        mOACI_code2.setKeyListener(null);                        mOACI_code3.setVisibility(View.VISIBLE);                        addImgBtn3.setVisibility(View.VISIBLE);                        oaciList.add(mOACI_code2.getText().toString());                        addImgBtn2.setImageResource(R.drawable.tick_inside_circle);                    }                    else{                        String warning_msg = getResources().getString(R.string.warning_msg_exist);                        Toast toast = Toast.makeText(getApplicationContext(), warning_msg, Toast.LENGTH_SHORT);                        toast.show();                    }                } else {                    String warnig_msg = getResources().getString(R.string.warning_msg_len);                    Toast toast = Toast.makeText(getApplicationContext(), warnig_msg, Toast.LENGTH_SHORT);                    toast.show();                }            }        });        addImgBtn3.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (mOACI_code3.getText().toString().length() == 4) {                    if(isOACIcode(mOACI_code3.getText().toString())){                        mOACI_code3.setEnabled(false);                        mOACI_code3.setKeyListener(null);                        mOACI_code4.setVisibility(View.VISIBLE);                        addImgBtn4.setVisibility(View.VISIBLE);                        oaciList.add(mOACI_code3.getText().toString());                        addImgBtn3.setImageResource(R.drawable.tick_inside_circle);                    }                    else{                        String warning_msg = getResources().getString(R.string.warning_msg_exist);                        Toast toast = Toast.makeText(getApplicationContext(), warning_msg, Toast.LENGTH_SHORT);                        toast.show();                    }                } else {                    String warnig_msg = getResources().getString(R.string.warning_msg_len);                    Toast toast = Toast.makeText(getApplicationContext(), warnig_msg, Toast.LENGTH_SHORT);                    toast.show();                }            }        });        addImgBtn4.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (mOACI_code4.getText().toString().length() == 4) {                    if(isOACIcode(mOACI_code4.getText().toString())){                        mOACI_code4.setEnabled(false);                        mOACI_code4.setKeyListener(null);                        addImgBtn4.setImageResource(R.drawable.tick_inside_circle);                        oaciList.add(mOACI_code4.getText().toString());                    }                    else{                        String warning_msg = getResources().getString(R.string.warning_msg_exist);                        Toast toast = Toast.makeText(getApplicationContext(), warning_msg, Toast.LENGTH_SHORT);                        toast.show();                    }                } else {                    String warnig_msg = getResources().getString(R.string.warning_msg_len);                    Toast toast = Toast.makeText(getApplicationContext(), warnig_msg, Toast.LENGTH_SHORT);                    toast.show();                }            }        });        researchBtn.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                Loading loading = new Loading();                loading.execute();            }        });        mOACI_code1.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View v, MotionEvent event) {                mOACI_code1.onTouchEvent(event);                if(!textFocus) {                    mOACI_code1.setSelection(mOACI_code1.getText().length());                    textFocus = true;                }                return true;            }        });        mOACI_code1.setOnFocusChangeListener(new View.OnFocusChangeListener() {            @Override            public void onFocusChange(View v, boolean hasFocus) {                textFocus = false;            }        });    }    public class Loading extends AsyncTask<Void, Integer, Void> {        ProgressDialog progressDialog;        @Override        protected void onPreExecute() {            super.onPreExecute();            progressDialog = new ProgressDialog(MainActivity.this);            progressDialog.setMessage(getResources().getString(R.string.loading));            progressDialog.setProgressStyle(ProgressDialog.STYLE_SPINNER);            progressDialog.show();            //Vérification d'une connexion internet établie            ConnectivityManager cm = (ConnectivityManager) getSystemService(getApplicationContext().CONNECTIVITY_SERVICE);            Boolean internetAvailable = cm.getActiveNetworkInfo() != null;            if (internetAvailable) {                for (int i = 0; i < oaciList.size(); i++) {                    String url = "https://v4p4sz5ijk.execute-api.us-east-1.amazonaws.com/anbdata/states/notams/notams-realtime-list?api_key=fe3e43a0-110a-11ea-b2d6-037b31839351&format=json&criticality=&locations=" + oaciList.get(i);                    RequestQueue queue = Volley.newRequestQueue(getApplicationContext());                    JsonArrayRequest jsArrayRequest = new JsonArrayRequest                            (Request.Method.GET, url, null, new Response.Listener<JSONArray>() {                                @Override                                public void onResponse(JSONArray responseArray) {                                    String text;                                    boolean snowtamFinded = false;                                    int cpt = 0;                                    String snowtam_field = "";                                    while (!snowtamFinded && (cpt < responseArray.length())) {                                        try {                                            JSONObject response = responseArray.getJSONObject(cpt);                                            snowtam_field = response.getString("all");                                            if (snowtam_field.contains("SNOWTAM")) {                                                text = snowtam_field;                                                snowtamFinded = true;                                            }                                            cpt++;                                        } catch (JSONException e) {                                            e.printStackTrace();                                        }                                    }                                    if(!snowtamFinded)                                        snowtam_field = getResources().getString(R.string.noSnowtamMsg);                                    jsonList.add(snowtam_field);                                    Log.i("TEST_REQUEST", snowtam_field);                                }                            }, new Response.ErrorListener() {                                @Override                                public void onErrorResponse(VolleyError error) {                                    progressDialog.cancel();                                    //Display error message whenever an error occurs                                    Toast.makeText(getApplicationContext(), error.getMessage(), Toast.LENGTH_SHORT).show();                                }                            });                    queue.add(jsArrayRequest);                }            } else {                //Informer qu'internet est nécessaire                Toast.makeText(getApplicationContext(), "Une connexion internet est nécessaire !", Toast.LENGTH_LONG).show();            }        }        @Override        protected void onProgressUpdate(Integer... values) {            super.onProgressUpdate(values);        }        @Override        protected Void doInBackground(Void... arg0) {            try {                Thread.sleep(3000);            } catch (InterruptedException e) {                e.printStackTrace();            }            return null;        }        @Override        protected void onPostExecute(Void result) {            super.onPostExecute(result);            progressDialog.cancel();            intent.putExtra("OACI_LIST", oaciList);            intent.putExtra("JSON_LIST", jsonList);            startActivity(intent);        }    }    public boolean isOACIcode(String OACI){        Aeroport aeroport = new Aeroport(OACI, getApplicationContext());        return !aeroport.getNom().equals("Not found");    }}